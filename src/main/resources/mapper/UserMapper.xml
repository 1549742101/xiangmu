<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.app.mapper.UserMapper">
    <insert id="registerCode" parameterType="com.example.app.util.SMS">
        insert into code (code.phone,code.code,code.time)
        values ('${phone}',${code.getKey()},NOW());
    </insert>
    <select id="getCode" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        select count(*) from code where code.code = ${code};
    </select>
    <select id="hasCol" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        select count(*) from where col_id = ${col_id}
    </select>
    <select id="hasUser" resultType="java.lang.Integer" parameterType="com.example.app.entity.User">
        select count(*) from user where
        <if test="username!=null">
            username='${username}' or
        </if>
        <if test="sno!=null">
            sno=${sno} or
        </if>
        <if test="phone!=null">
            phone='${phone}' or
        </if>
        1=2
    </select>
    <select id="login" parameterType="com.example.app.entity.User" resultMap="loginUser">
        SELECT id,username,password,sex,sno,phone,col_id,keyword,regtime,endtime FROM
        user where
        <if test="username!=null">
            username='${username}' or
        </if>
        <if test="sno!=null">
            sno=${sno} or
        </if>
        <if test="phone!=null">
            phone='${phone}' or
        </if>
        1=2
    </select>


    <resultMap id="loginUser" type="com.example.app.entity.User">
        <id property="id" column="id"></id>
        <result property="username" column="username"></result>
        <result property="passwords" column="password"></result>
        <result property="sex" column="sex"></result>
        <result property="sno" column="sno"></result>
        <result property="phone" column="phone"></result>
        <result property="col_id" column="col_id"></result>
        <result property="keyword" column="keyword"></result>
        <result property="regtime" column="regtime"></result>
        <result property="endtime" column="endtime"></result>
    </resultMap>
    <insert id="register" useGeneratedKeys="true" keyProperty="id" parameterType="com.example.app.entity.User">
        INSERT INTO user (username, password, sex, sno, phone, col_id, keyword, regtime)
        VALUES ('${username}', '${password}', ${sex}, '${sno}', '${phone}', ${col_id}, '${keyword}', NOW())
    </insert>

    <insert id="insert_order" parameterType="com.example.app.entity.Order">
        insert into
    </insert>
    <insert id="insert_order_count" parameterType="com.example.app.entity.Order">
        insert into
    </insert>
</mapper>
